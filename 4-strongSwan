#! /bin/bash

installSoftware(){
    apt -qq -y install strongswan libcharon-extra-plugins
}

setupIPtables(){
    iptables -t nat -A POSTROUTING -s 10.31.2.0/24 -o eth0 -j MASQUERADE
    echo iptables-persistent iptables-persistent/autosave_v4 boolean true|debconf-set-selections
    echo iptables-persistent iptables-persistent/autosave_v6 boolean true|debconf-set-selections
    apt -qq -y install iptables-persistent
    echo RESET iptables-persistent/autosave_v4|debconf-communicate iptables-persistent
    echo RESET iptables-persistent/autosave_v6|debconf-communicate iptables-persistent
}

setupSysctl(){
    cat > /etc/sysctl.d/90-vpn-sysctl.conf <<-EOF
	net.ipv4.ip_forward=1
	EOF
}

main(){
    installSoftware
    setupIPtables
    setupSysctl
}

main
